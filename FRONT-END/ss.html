<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shared Code - QuickText</title>
    <link rel="stylesheet" href="./css/home.css">
</head>

<body>
    <nav>
        <h1>Quick<span>Text</span></h1>
        <p>Fast • Secure • Minimal</p>
    </nav>

    <div class="container">
        <div class="hero-text">
            <h2>Shared Code</h2>
            <p>Copy your generated content easily</p>
        </div>

        <div class="boxes" style="display: flex; justify-content: center;">
            <div class="box" style="width: 30%; max-width:100%; max-height: 80%;">
                <h3>Generated Content</h3>
                <textarea id="myText" readonly style="width: 100%; padding: 10px; resize: none; overflow: hidden;"> </textarea>
                 <button class="btn-primary" id="copyBtn" onclick="copyText()">Copy to Clipboard</button>
            </div>
        </div>
    </div>

    <script>

        const urlparams = new URLSearchParams(window.location.search);
        const input = document.getElementById("myText");
        const content1 = urlparams.get('code');
        

        
async function fetchData() {
    try {
        const codeValue = content1;

        const response = await fetch(`http://localhost:3000/getdata?code=${codeValue}`);
        const res = await response.json();

        console.log(res);

        // If file exists → download it
        if (res.content.file) {

            // Convert Windows backslashes to URL format
            const filePath = res.content.file.replace(/\\/g, "/");
    const fileName = filePath.split("/").pop();

    const link = document.createElement("a");
    link.href = `http://localhost:3000/download/${fileName}`;

    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);

    return;
        }

        // Otherwise show text
        input.value = res.content.text || "";
        autoResize(input);

    } catch (error) {
        console.error("Error fetching data:", error);
        alert("Something went wrong!");
    }
}





        function copyText() {
            const input = document.getElementById("myText");
            const button = document.getElementById("copyBtn");

            if (!input.value) return;

            navigator.clipboard.writeText(input.value)
                .then(() => {
                    button.innerText = "Copied ✓";
                    button.style.background = "linear-gradient(135deg, #10b981 0%, #059669 100%)";

                    setTimeout(() => {
                        button.innerText = "Copy to Clipboard";
                        button.style.background = "";
                    }, 2000);
                });
        }
        function autoResize(textarea) {
    textarea.style.height = "auto"; // reset height
    textarea.style.height = textarea.scrollHeight + "px";
}
        
      fetchData();
    </script>
</body>

</html>